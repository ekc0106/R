# 데마 과제5
# [과제 5] <1> 5장 연습문제 1 (BreastCancer 데이터)
# <2> 5장 연습문제 3 <3> CDC 2010 데이터에 대하여 atRisk가 출력변수인 의사결정 나무모형을 적합하고 결과를 해석하시오. 
# (제출: 4월 19일)
### 과제5 설명
# 5-1.rpart 쓰면 편하겟죠 그건 푸르닝까지 해주니까~(푸르닝까지 다해서 의사결정(양성인지 악성인지..)
# 나무그리라는거)
rm(list=ls())
library(mlbench)
data("BreastCancer")
sum(is.na(BreastCancer)) #NA값이 있기에 생략해보자.
bc <- na.omit(BreastCancer[,-1])
bc[1:9] <- apply(bc[1:9],2,as.numeric)
str(bc)
bc.tr <- tree(Class~.,data = bc)
plot(bc.tr) ; text(bc.tr, all = T)
bc.tr 

bc.tr2 <- prune.misclass(bc.tr)
plot(bc.tr2) # 6부터 아예 차이가 없어짐.
fin_bc.tr <- prune.misclass(bc.tr, best=6)
plot(fin_bc.tr) ; text(fin_bc.tr, all = T)
# prune.misclass함수의 교차확인 오분류율을 이용하여 k가 최소가 되는 끝마디를 선택하여(현재 경우 6) 가지치기한 결과의 나무모형은 다음과 같다.

# 5-3. mlbench 패키지의 HouseVotes84자료에 대해 party 패키지의 함수로 나무모형 적합하고 결과를 해석하라.
#유의할점..데이터 전처리 해야함. 이거는 아마...민주당인지 공화당인 지 이런 거 분류하는건데. 
#변수가 법안에 찬성인지 반댄지 기권(NA)인지...NA를지우면 너무 많아 지우기 좀 그럴거임 
#그러므로 찬성 기권 반대를 1 2 3 이런식으로 ....바꾸라.
data("HouseVotes84")
sum(is.na(HouseVotes84)) # 데이터를 보았을 때, 기권표(NA)가 너무많아 생략하기 보단 기권이라는 새로운 level  주는 것이 더 좋아보임.
hv <- HouseVotes84[,-1]
str(hv)
for (i in 1:length(hv)){
  hv[,i] <- as.character(hv[,i])
  hv[,i][is.na(hv[,i])] <- 'abstain'
  hv[,i] <- as.factor(hv[,i])
}
str(hv)
hv <- cbind(Class=HouseVotes84$Class,hv)

library(party)
hv_ctree <- ctree(Class~.,data=hv)
print(hv_ctree)
plot(hv_ctree)
# 몇가지 예시를 통해 해석을 하자면, V4의 법안에서 기권 또는 반대를 한 쪽 중에서 V3를 를 기권한 쪽은 민주당과 공화당을 (0.67:0.33)으로 분류한다. 그리고 V4를 찬성한사람중 V11을 반대또는기권하고, 그 중 V15를 반대또는 기권한 사람은 민주당과 공화당을 (0.008:0.992)로 분류한다.
#3. 옵티말하게 피팅된 트리를 볼 필요 잇음. 다 할 필요없고 앞의 한두개split?정도...!
